<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{% if page.title %}{{ page.title | escape }} - {{ site.title | escape }}{% else %}{{ site.title | escape }}{% endif %}</title>
    <meta name="description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description | escape }}{% endif %}">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title | escape }}{% endif %}">
    <meta property="og:description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description | escape }}{% endif %}">
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    {% if page.image %}
    <meta property="og:image" content="{{ page.image | absolute_url }}">
    {% else %}
    <meta property="og:image" content="{{ '/assets/hero-earfun-products.jpg' | absolute_url }}">
    {% endif %}
    <meta property="og:site_name" content="{{ site.title | escape }}">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% if page.title %}{{ page.title | escape }}{% else %}{{ site.title | escape }}{% endif %}">
    <meta name="twitter:description" content="{% if page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description | escape }}{% endif %}">
    {% if page.image %}
    <meta name="twitter:image" content="{{ page.image | absolute_url }}">
    {% else %}
    <meta name="twitter:image" content="{{ '/assets/hero-earfun-products.jpg' | absolute_url }}">
    {% endif %}
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ page.url | absolute_url }}">
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/favicons/apple-touch-icon.png' | relative_url }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ '/assets/favicons/favicon-32x32.png' | relative_url }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ '/assets/favicons/favicon-16x16.png' | relative_url }}">
    <link rel="manifest" href="{{ '/assets/favicons/site.webmanifest' | relative_url }}">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/affiliate.css' | relative_url }}">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "{% if page.layout == 'post' %}BlogPosting{% else %}WebSite{% endif %}",
        "name": "{{ site.title | escape }}",
        "description": "{{ site.description | escape }}",
        "url": "{{ site.url }}{{ site.baseurl }}",
        "publisher": {
            "@type": "Organization",
            "name": "{{ site.title | escape }}",
            "logo": {
                "@type": "ImageObject",
                "url": "{{ '/assets/logo.svg' | absolute_url }}"
            }
        }{% if page.layout == 'post' %},
        "headline": "{{ page.title | escape }}",
        "datePublished": "{{ page.date | date_to_xmlschema }}",
        "dateModified": "{% if page.last_modified_at %}{{ page.last_modified_at | date_to_xmlschema }}{% else %}{{ page.date | date_to_xmlschema }}{% endif %}",
        "author": {
            "@type": "Person",
            "name": "{{ page.author | default: site.author | escape }}"
        },
        "image": "{% if page.image %}{{ page.image | absolute_url }}{% else %}{{ '/assets/hero-earfun-products.jpg' | absolute_url }}{% endif %}"{% endif %}
    }
    </script>
</head>
<body>
    <!-- Header -->
    <header>
        <nav>
            <div class="logo">
                <a href="{{ '/' | relative_url }}">
                    <img src="{{ '/assets/logo.svg' | relative_url }}" alt="{{ site.title }}" height="40">
                </a>
            </div>
            <ul class="nav-links">
                <li><a href="{{ '/' | relative_url }}">Home</a></li>
                <li><a href="{{ '/best/' | relative_url }}">Best Products</a></li>
                <li><a href="{{ '/reviews/' | relative_url }}">Reviews</a></li>
                <li><a href="{{ '/guides/' | relative_url }}">Guides</a></li>
                <li><a href="{{ '/deals/' | relative_url }}">Deals</a></li>
                <li><a href="{{ '/press-kit/' | relative_url }}">Press Kit</a></li>
            </ul>
            <!-- Mobile menu button -->
            <button class="mobile-menu-btn" aria-label="Toggle navigation menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>
    
    <!-- Main Content -->
    <main>
        {% if page.layout != 'home' %}
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="{{ '/' | relative_url }}">Home</a>
            {% assign crumbs = page.url | remove:'/index.html' | split: '/' %}
            {% for crumb in crumbs offset: 1 %}
                {% unless forloop.last %}
                    {% if crumb != '' %}
                        / <a href="{% assign crumb_limit = forloop.index | plus: 1 %}{% for c in crumbs limit: crumb_limit %}{{ c | append: '/' }}{% endfor %}">{{ crumb | replace:'-',' ' | remove:'.html' | capitalize }}</a>
                    {% endif %}
                {% else %}
                    / {{ crumb | replace:'-',' ' | remove:'.html' | capitalize }}
                {% endunless %}
            {% endfor %}
        </div>
        {% endif %}
        
        {{ content }}
    </main>
    
    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>EarFun Audio Blog</h3>
                <p>Your trusted source for EarFun audio product reviews, guides, and recommendations.</p>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="{{ '/best/' | relative_url }}">Best Products</a></li>
                    <li><a href="{{ '/reviews/' | relative_url }}">Reviews</a></li>
                    <li><a href="{{ '/guides/' | relative_url }}">Guides</a></li>
                    <li><a href="{{ '/deals/' | relative_url }}">Deals</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Resources</h3>
                <ul>
                    <li><a href="{{ '/press-kit/' | relative_url }}">Press Kit</a></li>
                    <li><a href="{{ '/bluetooth-codecs.html' | relative_url }}">Bluetooth Codecs</a></li>
                    <li><a href="{{ '/choosing-earbuds.html' | relative_url }}">Choosing Earbuds</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; {{ 'now' | date: "%Y" }} {{ site.title }}. All rights reserved.</p>
            <p><em>Affiliate Disclosure:</em> This site contains affiliate links. We may earn a commission from purchases made through these links at no additional cost to you.</p>
        </div>
    </footer>
    
    <!-- Scripts -->
    <script>
        // Mobile menu toggle - Enhanced
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const navLinks = document.querySelector('.nav-links');
            
            if (mobileMenuBtn && navLinks) {
                mobileMenuBtn.addEventListener('click', function() {
                    navLinks.classList.toggle('active');
                    this.classList.toggle('active');
                });
                
                // Close menu when clicking on a link
                navLinks.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', () => {
                        navLinks.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                    });
                });
                
                // Close menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (!mobileMenuBtn.contains(e.target) && !navLinks.contains(e.target)) {
                        navLinks.classList.remove('active');
                        mobileMenuBtn.classList.remove('active');
                    }
                });
            }
        });
        
        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // Add fade-in animation to cards when they come into view
        if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                    }
                });
            });
            
            document.querySelectorAll('.card, .product-card').forEach(card => {
                observer.observe(card);
            });
        }
    </script>
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    </script>
    <script>
        // Progressive enhancement for images: enforce lazy/async where missing
        (function(){
            const imgs = document.querySelectorAll('img');
            imgs.forEach(img => {
                if (!img.hasAttribute('loading')) img.setAttribute('loading', 'lazy');
                if (!img.hasAttribute('decoding')) img.setAttribute('decoding', 'async');
            });
        })();
    </script>
    
    <!-- Analytics placeholder -->
    {% if site.google_analytics %}
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}
</body>
</html>